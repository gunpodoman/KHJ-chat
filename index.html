<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom AI Chat with Learned Style</title>
    <style>
        /* Global Styles */
        :root {
            --bg-color: #f0f4f8;
            --chat-bg: #ffffff;
            --input-bg: #ffffff;
            --text-color: #333333;
            --user-bubble: #007bff;
            --ai-bubble: #e9ecef;
            --accent-color: #007bff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            width: 100%;
            max-width: 800px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: var(--chat-bg);
            box-shadow: var(--shadow);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        /* Header */
        .header {
            padding: 16px;
            background-color: var(--accent-color);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            margin: 0;
            font-size: 1.5rem;
        }

        .settings {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings label {
            font-size: 0.875rem;
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: var(--border-radius);
            animation: fadeIn 0.3s ease;
            word-wrap: break-word;
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--user-bubble);
            color: white;
        }

        .ai-message {
            align-self: flex-start;
            background-color: var(--ai-bubble);
            color: var(--text-color);
        }

        .loading {
            align-self: center;
            font-style: italic;
            color: #888;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .loading::after {
            content: '';
            width: 8px;
            height: 8px;
            background-color: #888;
            border-radius: 50%;
            animation: dotPulse 1.5s infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes dotPulse {
            0%, 20% { transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }

        /* Input Area */
        .input-area {
            display: flex;
            padding: 16px;
            background-color: var(--input-bg);
            border-top: 1px solid #ddd;
        }

        #user-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            resize: none;
            outline: none;
        }

        #send-btn {
            margin-left: 8px;
            padding: 12px 24px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #send-btn:hover {
            background-color: #0056b3;
        }

        #send-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* Dark Mode */
        body.dark-mode {
            --bg-color: #121212;
            --chat-bg: #1e1e1e;
            --input-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --user-bubble: #0d47a1;
            --ai-bubble: #424242;
            --accent-color: #2196f3;
        }

        .theme-toggle {
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Scrollbar Styling */
        .chat-area::-webkit-scrollbar {
            width: 8px;
        }

        .chat-area::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.2rem;
            }

            .settings {
                flex-direction: column;
                gap: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Custom AI Chat with Learned Style</h1>
            <div class="settings">
                <span class="theme-toggle" onclick="toggleTheme()">🌙</span>
            </div>
        </div>
        <div class="chat-area" id="chat-area"></div>
        <div class="input-area">
            <textarea id="user-input" rows="1" placeholder="Type your message..."></textarea>
            <button id="send-btn">Send</button>
        </div>
    </div>

    <script>
        const chatArea = document.getElementById('chat-area');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');

        // 학습 데이터: 여기서 특정 인물의 글을 배열로 저장. 사용자가 직접 수정/추가 가능.
        // 예시 데이터 (실제 데이터로 교체하세요. 더 추가할 수 있음).
        const learningData = [
            "저런~! 또 무슨 보물을 발견한 듯 링크를 눌러봤더니, 역시나 기대를 저버리지 않는 글이 기다리고 있구나. 참 대단하다. 미술 수업에만 집중한 선생님이 인성교육을 못 시켜줬다는 신박한 해석이라니, 이 정도면 역사책에 실어도 되겠다. 그런데 그 멋들어진 댓글과 게시글은 누가 그렇게 열심히 써준 걸까? 수업을 듣지도 않는 학생이? 1학기 때 부정행위로 적발되어 유명세를 탔던 그 주인공들? 아니면 초대도 안 했는데 남의 클래스룸에 숨어들어온 고도의 잠입 전문가들? 애초에 장난이 없었다면 이런 글을 읽을 필요조차 없었겠지. 그런데 굳이 사건을 만들고, 거기에 글까지 남기고, 또 댓글로 정당화까지 해주다니… 참 성실하다 못해 감동적이야. 법적으로는 재물손괴죄라 불리는 범죄도 '인성교육의 연장선'쯤으로 해석하는 그 위대한 창의력! 이 정도면 변호사 사무실 문 앞에서라도 상을 받아야 하지 않을까? CCTV 이야기도 나오더구나. 아, 맞다. 교실에는 설치 못 한다는 걸 혹시 몰랐나? 인권이라는 가치가 우선이라서 그렇지. 하지만 혹시 모를 심각한 사안이 발생하면 확인할 수 있도록 설치해 두기도 하지. 그걸 보고도 '아무도 확인 안 하겠지'라며 태평하게 장난치는 모습이 참으로 순수하다. 이런 걸 어른들은 ‘철없음’이라 부르지. 그리고 실명까지 거론하며 글을 썼다지? 와, 이 정도 용기는 정말 본받아야 해. 실명 거론이 얼마나 위험한지 전혀 모르는 무모한 배짱이라니, 어디 가서 창업이라도 하면 망해도 웃으면서 박수 쳐줄 것 같다. 게다가 글 쓴 시간대가 또 걸작이야. 등교 직전, 한밤중, 수업시간, 시험기간까지. 학문적 열정은 어디로 가고, 장난에 대한 열정만 활활 타오르는 모습이라니! 어쩌면 세상에서 제일 정성스러운 ‘장난 연구자’가 아닐까 싶구나. 결국 남는 건 하나야. 스스로 초등학생보다도 못한 장난을 치면서 '나는 어른이다'라고 착각하는 그 씁쓸한 자기모순. 다시 본인이 쓴 글을 찬찬히 읽어보렴. 그리고 거울을 한번 들여다봐. 거기 있는 사람이 정말 너 스스로 자랑스럽게 내세울 수 있는 사람인지.",
            "저런~! 오늘은 또 무슨 일이 있나 했더니 책상을 세게 치는 장난 이야기가 들리네. 너희가 재미있자고 한 행동이 다른 사람에게는 큰 불편과 방해가 된다는 거 아직도 모르겠니? 책상은 공부하고 작업하는 공간이지, 드럼 치는 소품이 아니야. 누가 그런 소리를 듣고 집중이 되겠니. 앞으로 미술실에서 유토로 장난치지 말고, 책상 세게 치는 행동은 절대 하지 말아라. 수업에 방해되고, 같이 있는 친구들까지 피곤하게 만든다. 본인이 한 행동은 본인이 멈추는 게 가장 빠른 해결책 아니겠니? 만약 또 이런 일이 반복된다면 원상복구, 반성문 제출, 학교에 알림까지 갈 수 있음을 분명히 해둔다. 장난은 즐겁자고 하는 건데, 누군가를 괴롭히거나 방해하는 건 장난이 아니라 그냥 피해다. 다시 한번 말한다. 유토 장난, 책상 치기 금지. 앞으로는 서로 배려하는 태도로 미술실을 지켜주길 바란다. ㅇㅋ? 제보는 비공개 댓글로. 잘 자라.",
            ""
        ];

        // 시스템 프롬프트: 학습 데이터를 기반으로 말투 학습
        const systemPrompt = `You are imitating a specific person's speaking style based on the following texts they wrote. Always respond in a similar tone, vocabulary, and structure. Do not break character. Learning texts:\n${learningData.join('\n\n')}`;

        let chatHistory = [{ role: 'system', content: systemPrompt }];

        // Auto-resize textarea
        userInput.addEventListener('input', () => {
            userInput.style.height = 'auto';
            userInput.style.height = `${userInput.scrollHeight}px`;
        });

        // Theme toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const toggle = document.querySelector('.theme-toggle');
            toggle.textContent = document.body.classList.contains('dark-mode') ? '☀️' : '🌙';
        }

        // Add message to chat
        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', isUser ? 'user-message' : 'ai-message');
            messageDiv.textContent = content;
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // Handle send
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            addMessage(message, true);
            userInput.value = '';
            userInput.style.height = 'auto';
            sendBtn.disabled = true;

            // Loading indicator
            const loadingDiv = document.createElement('div');
            loadingDiv.classList.add('loading');
            loadingDiv.textContent = 'AI is thinking in the learned style...';
            chatArea.appendChild(loadingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;

            // Update history
            chatHistory.push({ role: 'user', content: message });

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        messages: chatHistory
                    })
                });

                if (!response.ok) {
                    throw new Error(`Error: ${response.statusText}`);
                }

                const data = await response.json();
                const aiResponse = data.aiResponse.trim();
                chatHistory.push({ role: 'assistant', content: aiResponse });

                // Remove loading
                chatArea.removeChild(loadingDiv);
                addMessage(aiResponse);

            } catch (error) {
                chatArea.removeChild(loadingDiv);
                addMessage(`Error: ${error.message}`);
            } finally {
                sendBtn.disabled = false;
                userInput.focus();
            }
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Initial message
        addMessage('환영합니다! 특정 인물의 말투를 따라하는 AI 채팅입니다. 학습 데이터를 기반으로 응답할게요. 메시지를 보내세요.', false);
    </script>
</body>
</html>
